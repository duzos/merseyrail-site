<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <img id="segment" src="img/header.png" alt="Merseyrail text">
    <div class="blank-block"></div>
    <div class="track-container">
        <img id="segment" src="img/station.png" alt="Merseyrail station">
        <img id="train" src="img/777.png" alt="777 Class Train"/>
    </div>
    <script>
const pauseDuration = 5000; // ms

function setClass(train, className) {
    train.className = className;
}

let is777 = true;

function swapImage(train) {
    is777 = !is777;
    train.src = is777 ? 'img/777.png' : 'img/507.png';
    train.alt = is777 ? '777 Class Train' : '507 Class Train';
}

const train = document.getElementById('train');
let state = 'init';

function nextStep() {
    switch (state) {
        case 'init':
            swapImage(train);
            setClass(train, 'right');
            state = 'toCenter';
            requestAnimationFrame(() => setClass(train, 'center'));
            break;
        case 'toCenter':
            state = 'pauseCenter';
            setTimeout(() => {
                setClass(train, 'left');
                state = 'toLeft';
            }, pauseDuration);
            break;
        case 'toLeft':
            state = 'toRight';
            setClass(train, 'right');
            void train.offsetWidth;
            requestAnimationFrame(() => {
                swapImage(train);
                setClass(train, 'center');
                state = 'toCenter';
            });
            break;
    }
}

train.addEventListener('transitionend', (e) => {
    if (e.propertyName === 'left') {
        nextStep();
    }
});

// Start animation
state = 'init';
nextStep();
    </script>
</body>
</html>